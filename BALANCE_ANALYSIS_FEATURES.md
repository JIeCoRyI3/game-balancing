# Новые функции анализа баланса

## Обзор

Добавлены три новые функции для детального анализа и балансировки игровых карт:

## 1. Симуляции с фиксированными характеристиками героев

### Описание
Теперь возможно проводить множественные симуляции БЕЗ рандомизации характеристик героев (здоровья, маны и выносливости).

### Как использовать
1. Перейдите на страницу "Симуляция Боя"
2. Выберите режим "Множественные симуляции"
3. Установите флажок "Использовать фиксированные характеристики героев"
4. Все симуляции будут проводиться с точными значениями здоровья, маны и выносливости, установленными в настройках героя

### Преимущества
- Позволяет точно оценить баланс карт при конкретных значениях характеристик
- Идеально для тестирования баланса на определенном уровне силы героя
- Упрощает выявление дисбаланса без влияния вариативности характеристик

## 2. Предложения по перераспределению поинтов силы

### Описание
Система автоматически анализирует винрейты карт и предлагает корректировки поинтов силы для достижения лучшего баланса.

### Алгоритм расчета
- **Цель**: Карты с винрейтом 50% должны иметь ~0 поинтов силы
- **Формула**: Каждый 1% отклонения от 50% винрейта = ~0.5 поинта силы корректировки
- **Вес по импакту**: Корректировка умножается на коэффициент важности карты (impact score)

### Что показывает таблица
- **Текущие PP**: Текущие поинты силы карты
- **Предложенные PP**: Рекомендуемые поинты силы после корректировки
- **Изменение**: Необходимое изменение (+ для усиления, - для ослабления)
- **Винрейт**: Текущий винрейт карты
- **Обоснование**: Детальное объяснение причины корректировки

### Интерпретация результатов
- **Красное изменение (+)**: Карта слишком сильная, нужно увеличить стоимость (больше поинтов)
- **Зеленое изменение (-)**: Карта слишком слабая, нужно уменьшить стоимость (меньше поинтов)

## 3. Рекомендации по идеальному балансу системы

### Описание
Комплексный анализ, который предлагает оптимальные значения здоровья, маны и выносливости героя, а также перераспределение силы всех карт для достижения идеального баланса.

### Что включает

#### Идеальные параметры героя
- **Округленные значения**: Система предлагает удобные целые числа (кратные 10)
- **Основа на лучшем диапазоне**: Выбирается на основе анализа диапазонов с наилучшим балансом карт
- **Избежание дробных чисел**: Все значения целые для удобства использования

#### Корректировки карт
- **Таблица изменений**: Показывает какие карты нужно изменить и насколько
- **Интеграция с поинтами силы**: Объединяет анализ винрейтов с рекомендациями по шкале

#### Пошаговая инструкция
1. Настройка характеристик героя на предложенные значения
2. Обновление поинтов силы карт согласно таблице
3. Проверка баланса через новые симуляции с фиксированными характеристиками
4. Итеративное улучшение при необходимости

## Рабочий процесс

### Оптимальная последовательность действий:

1. **Первичный анализ**
   - Запустите 500-1000 симуляций с рандомизацией
   - Получите общее представление о балансе карт

2. **Изучение рекомендаций**
   - Просмотрите предложения по поинтам силы
   - Изучите рекомендации по идеальному балансу системы
   - Обратите внимание на предложенные значения здоровья/маны/выносливости

3. **Применение изменений**
   - Обновите характеристики героя на "Настройки героя"
   - Измените поинты силы характеристик на странице "Характеристики"

4. **Проверка с фиксированными характеристиками**
   - Запустите 100-200 симуляций с ФИКСИРОВАННЫМИ характеристиками
   - Проверьте, насколько улучшился баланс

5. **Итерация**
   - При необходимости повторите процесс
   - Продолжайте корректировать до достижения целевого баланса

## Технические детали

### Файлы изменений
- `/workspace/src/pages/BattleSimulationPage.tsx` - UI и логика симуляций
- `/workspace/src/utils/simulationAnalytics.ts` - Алгоритмы анализа
- `/workspace/src/pages/BattleSimulationPage.css` - Стили

### Новые функции аналитики
- `calculatePowerPointSuggestions()` - Расчет предложений по поинтам силы
- `calculateScalingSuggestions()` - Расчет рекомендаций по масштабированию системы

### Интерфейсы
```typescript
interface PowerPointSuggestion {
  cardId: string;
  cardName: string;
  currentPowerPoints: number;
  suggestedPowerPoints: number;
  adjustment: number;
  winRate: number;
  reason: string;
}

interface ScalingSuggestion {
  targetHealth: number;
  targetMana: number;
  targetStamina: number;
  healthScale: number;
  resourceScale: number;
  description: string;
  cardAdjustments: Array<{
    cardId: string;
    cardName: string;
    currentPowerPoints: number;
    scaledPowerPoints: number;
  }>;
}
```

## Примеры использования

### Пример 1: Тестирование новой карты
1. Добавьте новую карту в систему
2. Создайте несколько колод с этой картой
3. Запустите 500 симуляций с фиксированными характеристиками
4. Оцените винрейт карты - он должен быть близок к 50%
5. Если нет - скорректируйте поинты силы согласно предложениям

### Пример 2: Глобальная перебалансировка
1. Запустите 1000 симуляций с рандомизацией
2. Изучите "Рекомендации по идеальному балансу системы"
3. Примените все предложенные изменения
4. Запустите 500 симуляций с фиксированными характеристиками для проверки
5. Повторите при необходимости

### Пример 3: Точная настройка для эндгейма
1. Определите целевые характеристики героя для эндгейма (например, 1000 HP, 100 Mana)
2. Установите эти значения в настройках героя
3. Запустите 1000 симуляций с фиксированными характеристиками
4. Получите точные рекомендации по балансу для этого уровня силы
5. Примените корректировки

## Советы и лучшие практики

1. **Достаточный размер выборки**: Используйте минимум 100 симуляций для надежных результатов
2. **Итеративный подход**: Не ожидайте идеального баланса с первой попытки
3. **Фокус на импакте**: Сначала исправляйте карты с высоким impact score
4. **Проверка после изменений**: Всегда запускайте контрольные симуляции после изменений
5. **Документирование**: Записывайте значения до и после для отслеживания прогресса

## Интерпретация метрик

### Винрейт
- **45-55%**: Отличный баланс
- **40-45% или 55-60%**: Приемлемый, небольшая корректировка
- **< 40% или > 60%**: Требуется значительная корректировка

### Impact Score
- **< 10**: Низкое влияние на исход боев
- **10-20**: Среднее влияние
- **> 20**: Высокое влияние, приоритет для балансировки

### Отклонение от 50%
- **< 5%**: Превосходный баланс
- **5-10%**: Хороший баланс
- **10-15%**: Требуется корректировка
- **> 15%**: Критический дисбаланс
